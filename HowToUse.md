Warning: This text was generated by AI and reviewd by a human!!!

# DorelLogger

A modern C++20 logging library for Windows with customizable output formats, multiple sink targets, and built-in `std::format` integration.

## Features

- **Multiple sinks** — Log to the Windows debug stream, standard files, WinAPI files, WinRT files, or MSI installer logs simultaneously
- **Custom output formats** — Define per-sink message formats with rich variable support (timestamps, process/thread info, source location, etc.)
- **`std::format` integration** — Use `std::format`-style formatting in log messages, with built-in formatters for Windows types (`GUID`, `HRESULT`, `ErrorCode`), STL types (`std::filesystem::path`, `std::vector`, `std::pair`), and ATL strings (`CStringW`, `CStringA`)
- **Enum-to-string formatting** — Define `std::formatter` specializations for any enum or integer-based type with a single macro
- **Thread-safe** — Synchronized access to sinks with per-thread naming support
- **Session prolog/epilog** — Automatically log custom messages at the start and end of a logging session
- **Statistics collection** — Optional per-sink statistics (message counts, lengths, etc.)
- **Severity filtering** — Filter messages by level (`Trace`, `Info`, `Warning`, `Error`) at both logger and sink level

## Quick Start

### 1. Include the default usage header

```cpp
#include "DorelLogger/defaultUsage.h"
```

This pulls in the logger provider, macros, and all standard formatters.

### 2. Initialize the logger

```cpp
auto& logger = GET_LOGGER();

auto sink = std::make_unique<DorelLogger::WindowsDebugStreamSink>();
sink->SetMessageFormat(
    L"{Year}-{MonthNo}-{DayNo} {Hour24}:{Minute}:{Second}.{MiliSec} "
    L"[{ProcessId}:{ThreadId}] {MsgType} {FilePathShort}:{LineNo} - {Msg}");

logger.AddSink(std::move(sink));
logger.SetMinLogLevel(DorelLogger::MessageType::Trace);
```

### 3. Log messages

**Stream-style (using `<<` operator):**

```cpp
LOG_INFO(L"User " << userName << L" logged in from " << ipAddress);
LOG_WARNING(L"Disk usage is at " << percentage << L"%");
```

**`std::format`-style:**

```cpp
LOG_INFO_FMT(L"User {} logged in from {}", userName, ipAddress);
LOG_WARNING_FMT(L"Disk usage is at {}%", percentage);
LOG_ERROR_FMT(L"Operation failed with error={:A}", ErrorCode(hr));
```

## Sinks

| Sink | Description |
|------|-------------|
| `WindowsDebugStreamSink` | Outputs to `OutputDebugString` (visible in Visual Studio Output window) |
| `StdFileSink` | Writes to a file using `std::wofstream` |
| `WinApiFileSink` | Writes to a file using Win32 `CreateFile`/`WriteFile` APIs |
| `WinRtFileSink` | Writes to a file using WinRT `StorageFile` APIs (requires `ENABLE_WINRTFILE_SINK` macro) |
| `MsiLogSink` | Writes to the Windows Installer log (for custom actions) |

Each sink can have its own message format and minimum severity level:

```cpp
auto fileSink = std::make_unique<DorelLogger::StdFileSink>();
fileSink->SetMessageFormat(L"{Year}-{MonthNo}-{DayNo} {Hour24}:{Minute}:{Second} [{MsgType}] {Msg}");
fileSink->SetMinLogLevel(DorelLogger::MessageType::Warning); // Only warnings and errors
fileSink->OpenFile(L"app.log", false);
logger.AddSink(std::move(fileSink));
```

## Message Format Variables

Use these variables inside `{}` in format strings:

| Variable | Description | Example |
|----------|-------------|---------|
| `{Year}` | 4-digit year | `2026` |
| `{MonthNo}` | 2-digit month | `02` |
| `{MonthName}` | Month name | `February` |
| `{DayNo}` | Day number | `18` |
| `{DayName}` | Day name | `Wednesday` |
| `{Hour24}` | Hour (0–23) | `14` |
| `{Hour12}` | Hour (1–12) | `02` |
| `{Minute}` | Minutes | `35` |
| `{Second}` | Seconds | `09` |
| `{MiliSec}` | Milliseconds | `123` |
| `{NanoSec}` | Nanoseconds | `456789` |
| `{ProcessId}` | Process ID | `12345` |
| `{ProcessName}` | Process name | `MyApp.exe` |
| `{ThreadId}` | Thread ID | `6789` |
| `{ThreadName}` | Thread name (user-defined) | `WorkerThread` |
| `{MsgType}` | Severity level | `INFO` |
| `{FilePathFull}` | Full source file path | `C:\src\main.cpp` |
| `{FilePathShort}` | Short source file name | `main.cpp` |
| `{FuncName}` | Function name | `ProcessData` |
| `{LineNo}` | Source line number | `42` |
| `{CustVar}` | Custom variable value | *(user-defined)* |
| `{Msg}` | The log message body | *(your message)* |

### Format Modifiers

Variables support alignment, width, trimming, and verbatim suffixes:

```
{+12ProcessId}      → Right-aligned, 12 chars wide
{-20FilePathFull}   → Left-aligned, 20 chars wide
{=10MsgType}        → Center-aligned, 10 chars wide
{FilePathFull-10}   → Trim 10 chars from the left
{FilePathFull+30}   → Keep only the rightmost 30 chars
{FuncName:()}       → Append verbatim "()" after the value
```

## Custom Enum Formatting

Define `std::format`-compatible formatters for enums in two lines:

```cpp
enum class Status { Ok = 0, Pending = 1, Failed = 2 };

DL_DEFINE_VALUES_STRINGS_ARRAY(kStatusStrings,
                               DL_VAL_STR(Status::Ok),
                               DL_VAL_STR(Status::Pending),
                               DL_VAL_STR(Status::Failed));
DL_DEFINE_FORMATTER_SPECIALIZATION_FOR_TYPE(Status, kStatusStrings);

// Now use it:
LOG_INFO_FMT(L"Operation result: {}", Status::Ok);       // "Ok"
LOG_INFO_FMT(L"Operation result: {:F}", Status::Ok);     // "Status::Ok"
```

## ErrorCode Formatting

The `ErrorCode` wrapper provides rich formatting for Win32 error codes and HRESULTs:

```cpp
LOG_ERROR_FMT(L"Error: {:x}", ErrorCode(hr));   // lowercase hex
LOG_ERROR_FMT(L"Error: {:X}", ErrorCode(hr));   // uppercase hex
LOG_ERROR_FMT(L"Error: {:D}", ErrorCode(hr));   // text description
LOG_ERROR_FMT(L"Error: {:A}", ErrorCode(hr));   // hex + text description
```

`LOG_ERROR` and `LOG_ERROR_FMT` macros automatically capture `::GetLastError()` into a `lastError` variable that you can include in your message.

## Severity Levels

| Level | Usage |
|-------|-------|
| `MessageType::Trace` | Fine-grained diagnostic information |
| `MessageType::Info` | General operational messages |
| `MessageType::Warning` | Potential issues that aren't errors |
| `MessageType::Error` | Failures (auto-captures `GetLastError()`) |

## Requirements

- **C++20** or later
- **Windows** (uses Win32 APIs for several sinks and OS utilities)
- **MSVC** (Visual Studio 2022 17.x or later)

## License

[MIT — see LICENSE file]